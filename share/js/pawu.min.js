if(PlugAuth===undefined)var PlugAuth={};if(PlugAuth.UI===undefined)PlugAuth.UI={};(function()
{var page=PlugAuth.UI.login={};page.enable=function()
{$('#plugauth_webui_container').html('<form>'
+'<input id="plugauth_webui_login_user" name="user" type="text"     placeholder="username" />'
+'<br/>'
+'<input id="plugauth_webui_login_pass" name="pass" type="password" placeholder="password" />'
+'</form>');$('#plugauth_webui_toolbar').html('');PlugAuth.UI.Menu.clear();var user=$('#plugauth_webui_login_user');var pass=$('#plugauth_webui_login_pass');user.focus();$(document).ready(function(){PlugAuth.UI.bind_enter(user,function(){pass.focus()});PlugAuth.UI.bind_enter(pass,function(){page.attempt(user.val(),pass.val())});});}
page.attempt=function(user,pass)
{var client=new PlugAuth.Client(PlugAuth.UI.data.api_url);client.login(user,pass);client.auth()
.success(function(){page.success(client)})
.error(page.error);}
page.success=function(client)
{PlugAuth.UI.setup(client);var menu=new PlugAuth.UI.Menu.MenuItem('logout');menu.click(page.enable);menu.show();}
$(document).ready(function(){var login_error_modal=new PlugAuth.UI.Modal('Authentication Error');login_error_modal.html('<p>Either the credentials you provided were wrong, or there was an error in transport with the PlugAuth server.</p>'
+'<p>Response: <span class="badge badge-important" id="plugauth_webui_login_error_status"></span>'
+'             <span id="plugauth_webui_login_error_data"></span></p>');page.error=function(data,status)
{$('#plugauth_webui_login_error_status').html(status);$('#plugauth_webui_login_error_data').html(data);login_error_modal.show();};});})();if(PlugAuth===undefined)var PlugAuth={};if(PlugAuth.UI===undefined)PlugAuth.UI={};if(PlugAuth.UI.Menu===undefined)PlugAuth.UI.Menu={};(function()
{var counter=0;PlugAuth.UI.Menu.MenuItem=function(aName)
{this.name=aName;this.index=counter++;$('#plugauth_webui_main_menu').append('<li class="plugauth_webui_menu_item" id="plugauth_webui_menu_'+this.index+'_li">'
+'<a href="#" id="plugauth_webui_menu_'+this.index+'_a">'+this.name+'</a></li>');this.li=$('#plugauth_webui_menu_'+this.index+'_li');this.a=$('#plugauth_webui_menu_'+this.index+'_a');var mi=this;this.li.hide();this.a.click(function(){PlugAuth.UI.Menu.deselect();mi.select();mi.cb();return false;});this.cb=function(){};}
PlugAuth.UI.Menu.MenuItem.prototype.hide=function(){this.li.hide()}
PlugAuth.UI.Menu.MenuItem.prototype.show=function(){this.li.show()}
PlugAuth.UI.Menu.MenuItem.prototype.click=function(cb){this.cb=cb}
PlugAuth.UI.Menu.MenuItem.prototype.select=function(){this.li.addClass('active')}
PlugAuth.UI.Menu.clear=function()
{$('#plugauth_webui_main_menu').html('');}
PlugAuth.UI.Menu.deselect=function()
{$('.plugauth_webui_menu_item').removeClass('active');}})();if(PlugAuth===undefined)var PlugAuth={};(function()
{PlugAuth.Client=function(aUrl,aUsername)
{this.url=aUrl.replace(/\/$/,'');if(!(typeof(aUsername)==='undefined'))
this.user=aUsername;}
PlugAuth.Client.prototype.login=function(aUsername,aPassword)
{this.user=aUsername;this.pass=aPassword;return this;}
PlugAuth.Client.prototype.logout=function()
{delete this.user;delete this.pass;return this;}
PlugAuth.Client.create_fake_method=function(fake_data,fake_status)
{return function(){var tx=new PlugAuth.Client.Tx();setTimeout(function(){tx.success_cb(fake_data,fake_status)},1);return tx;};}
var request=function(client,args)
{args=jQuery.extend({},args);if(!(client.user===undefined)&&!(client.pass===undefined))
{var hash=$.base64.encode(client.user+':'+client.pass);args.beforeSend=function(req){req.setRequestHeader('Authorization','Basic '+hash);}}
args.url=client.url+args.url;var tx=new PlugAuth.Client.Tx();$.ajax(args)
.success(function(aData,textStatus,jqXHR)
{var data;if(jqXHR.getResponseHeader('Content-Type')=='application/json')
{data=JSON.parse(jqXHR.responseText);}
else
{data=aData;}
tx.success_cb(data,jqXHR.status);})
.error(function(jqXHR,textStatus,errorThrown)
{tx.error_cb(jqXHR.responseText,jqXHR.status)});return tx;}
PlugAuth.Client.prototype.version=function()
{return request(this,{url:'/version',type:'GET',});}
PlugAuth.Client.prototype.status=function()
{return request(this,{url:'/status',type:'GET',});}
PlugAuth.Client.prototype.auth=function()
{return request(this,{url:'/auth',type:'GET',});}
PlugAuth.Client.prototype.api=function()
{return request(this,{url:'/api',type:'GET',});}
PlugAuth.Client.prototype.welcome=function()
{return request(this,{url:'/',type:'GET',});}
PlugAuth.Client.prototype.authz=function(aUser,aAction,aResource)
{return request(this,{url:'/authz/user/'+[aUser,aAction,aResource].join('/'),type:'GET',});}
PlugAuth.Client.prototype.can=function(aAction,aResource)
{return this.authz(this.user,aAction,aResource);}
PlugAuth.Client.prototype.user_list=function()
{return request(this,{url:'/user',type:'GET'})}
PlugAuth.Client.prototype.group_list=function()
{return request(this,{url:'/group',type:'GET'})}
PlugAuth.Client.prototype.create_user=function(aUsername,aPassword)
{return request(this,{url:'/user',type:'POST',data:{user:aUsername,password:aPassword},});}
PlugAuth.Client.prototype.change_password=function(aUsername,aPassword)
{return request(this,{url:'/user/'+aUsername,type:'POST',data:{password:aPassword},});}
PlugAuth.Client.prototype.delete_user=function(aUsername)
{return request(this,{url:'/user/'+aUsername,type:'DELETE',});}
PlugAuth.Client.prototype.groups=function(aUsername)
{return request(this,{url:'/groups/'+aUsername,type:'GET',});}
PlugAuth.Client.prototype.users=function(aGroupname)
{return request(this,{url:'/users/'+aGroupname,type:'GET',});}
PlugAuth.Client.prototype.update_group=function(aGroupname,aUserlist)
{return request(this,{url:'/group/'+aGroupname,type:'POST',data:{users:aUserlist.join(',')},});}
PlugAuth.Client.prototype.group_add_user=function(aGroupname,aUser)
{return request(this,{url:'/group/'+aGroupname+'/'+aUser,type:'POST',});}
PlugAuth.Client.prototype.group_delete_user=function(aGroupname,aUser)
{return request(this,{url:'/group/'+aGroupname+'/'+aUser,type:'DELETE',});}
PlugAuth.Client.prototype.create_group=function(aGroupname,aUserlist)
{return request(this,{url:'/group',type:'POST',data:{group:aGroupname,users:aUserlist.join(',')},});}
PlugAuth.Client.prototype.delete_group=function(aGroupname)
{return request(this,{url:'/group/'+aGroupname,type:'DELETE',});}
PlugAuth.Client.prototype.granted=function()
{return request(this,{url:'/grant',type:'GET',});}
PlugAuth.Client.prototype.revoke=function(aUsername,aAction,aResource)
{return request(this,{url:'/grant/'+aUsername+'/'+aAction+'/'+aResource,type:'DELETE',});}
PlugAuth.Client.prototype.actions=function()
{return request(this,{url:'/actions',type:'GET',});}
PlugAuth.Client.prototype.grant=function(aUsername,aAction,aResource)
{return request(this,{url:'/grant/'+aUsername+'/'+aAction+'/'+aResource,type:'POST',});}
PlugAuth.Client.prototype.audit=function(aYear,aMonth,aDay)
{return request(this,{url:'/audit/'+aYear+'/'+aMonth+'/'+aDay,type:'GET',});}
PlugAuth.Client.prototype.audit_today=function()
{return request(this,{url:'/audit/today',type:'GET',});}
PlugAuth.Client.prototype.audit_check=function()
{return request(this,{url:'/audit',type:'GET',});}
PlugAuth.Client.prototype.test_basic=function()
{return request(this,{url:'/test/setup/basic',type:'POST',});}
PlugAuth.Client.Tx=function()
{this.success_cb=function(){};this.error_cb=function(){};}
PlugAuth.Client.Tx.prototype.success=function(aFunction){this.success_cb=aFunction;return this}
PlugAuth.Client.Tx.prototype.error=function(aFunction){this.error_cb=aFunction;return this}})();$(document).ready(function()
{var page=new PlugAuth.UI.Page('password');page.select=function()
{$('#plugauth_webui_container').html('<h3>change password<h3>'
+'<form id="plugauth_webui_change_password_form">'
+'<input class="span3" type="password" placeholder="password" id="plugauth_webui_change_password_password" /><br/>'
+'<input class="span3" type="password" placeholder="confirm"  id="plugauth_webui_change_password_confirm"/><br/>'
+'<button class="span3 btn btn-primary" type="button" id="plugauth_webui_change_password_submit" style="margin-left:0">Change Password</button>'
+'</form>');var password=$('#plugauth_webui_change_password_password');var confirm=$('#plugauth_webui_change_password_confirm');var submit=$('#plugauth_webui_change_password_submit');var change_password=function()
{if(password.val()=='')
{PlugAuth.UI.error_modal.html('<p>Passwords is empty</p>');PlugAuth.UI.error_modal.show();}
else if(password.val()!=confirm.val())
{PlugAuth.UI.error_modal.html('<p>Passwords do not match</p>');PlugAuth.UI.error_modal.show();}
else
{var new_password=password.val();var client=page.client;client.change_password(client.user,new_password)
.success(function(){PlugAuth.UI.notice_modal.html('<p>Password changed</p>');PlugAuth.UI.notice_modal.show();client.login(client.user,new_password);})
.error(function(){PlugAuth.UI.error_modal.html('<p>Error changing password</p>');PlugAuth.UI.error_modal.show();});}
password.val('');confirm.val('');};submit.click(change_password);PlugAuth.UI.bind_enter(password,function(){confirm.focus()});PlugAuth.UI.bind_enter(confirm,change_password);}
page.order=40;page.can=function()
{if((typeof page.client.user==="undefined")||(typeof page.client.pass==="undefined"))
return{success:function(){},failure:function(f){f()}};return page.client.can('change_password','user/'+page.client.user)}});$(document).ready(function()
{var clear;var fetch_audit_good;var fetch_audit_bad;var date_to_string;var convert_date;var csv_data=[];var page=new PlugAuth.UI.Page('audit','accounts','audit');page.select=function()
{$('#plugauth_webui_toolbar').html('  <a '+
'     href="#" '+
'     class="btn smal" '+
'     id="plugauth_webui_audit_date_button" '+
'     data-date-format="yyyy-mm-dd" '+
'     data-date="2012-02-12">Today</a>'+
'  <a href="#" class="btn small" id="plugauth_webui_audit_download">CSV</a>');$('#plugauth_webui_container').html('<table class="table table-striped">'+
'  <thead>'+
'    <tr>'+
'      <th>time</th>'+
'      <th>admin</th>'+
'      <th>event</th>'+
'      <th>user/group</th>'+
'      <th>arguments</th>'+
'    </tr>'+
'  </thead>'+
'  <tbody id="plugauth_webui_audit_table_body">'+
'  </tbody>'+
'</table>');$('#plugauth_webui_audit_download').click(function(){$('#plugauth_webui_audit_download').attr('href',PlugAuth.DL.data_to_uri({type:'text/csv',content:PlugAuth.CSV.stringify(csv_data)}));return true;});$('#plugauth_webui_audit_date_button').attr('data-date',date_to_string(new Date));$('#plugauth_webui_audit_date_button').html(date_to_string(new Date));$('#plugauth_webui_audit_download').attr('download','plugauth_audit_log_'+date_to_string(new Date)+'.csv');clear();var client=this.client;client.audit_today()
.error(fetch_audit_bad)
.success(fetch_audit_good);var widget;widget=$('#plugauth_webui_audit_date_button').datepicker({onRender:function(date){return'';}}).on('changeDate',function(ev){widget.hide();var date=convert_date(ev.date);clear();client.audit(date.year,date.month,date.day)
.error(fetch_audit_bad)
.success(fetch_audit_good);$('#plugauth_webui_audit_date_button').html(date_to_string(ev.date));$('#plugauth_webui_audit_download').attr('download','audit_log_'+date_to_string(ev.date)+'.csv');}).data('datepicker');};convert_date=function(date)
{var answer={};answer.year=date.getFullYear();answer.month=date.getMonth()+1;answer.day=date.getDate();if(answer.month<10)
answer.month='0'+answer.month;if(answer.day<10)
answer.day='0'+answer.day;return answer;}
date_to_string=function(date)
{date=convert_date(date);return date.year+'-'+date.month+'-'+date.day;}
clear=function()
{$('#plugauth_webui_audit_table_body').html('');csv_data=[['time','admin','event','user/group','arguments']];}
fetch_audit_good=function(data)
{data.forEach(function(element){var args_html=[];var args_txt=[];for(var key in element)
{if(element.hasOwnProperty(key)&&!key.match(/^time_/)&&!key.match(/^(admin|event|user|group)$/))
{args_html.push('<strong>'+key+'</strong>='+element[key]);args_txt.push([key,element[key]].join('='));}}
args_html=args_html.join(', ');args_txt=args_txt.join(', ');var user=element.user||element.group||'';$('#plugauth_webui_audit_table_body').append('<tr>'+
'  <td>'+element.time_human+'</td>'+
'  <td>'+element.admin+'</td>'+
'  <td>'+element.event+'</td>'+
'  <td>'+user+'</th>'+
'  <td>'+args_html+'</td>'+
'</tr>');csv_data.push([element.time_human,element.admin,element.event,user,args_txt]);});}
fetch_audit_bad=function(data)
{PlugAuth.UI.error_modal.html('<p>No entries for that day</p>');PlugAuth.UI.error_modal.show();}});/*
 * https://npmjs.org/package/csv-string
 * 
 * Copyright 2011 Nicolas Thouvenin <nthouvenin@gmail.com>
 * 
 * Licensed under the MIT/X11 license
 */
if(PlugAuth===undefined)var PlugAuth={};if(PlugAuth.CSV===undefined)PlugAuth.CSV={};(function(exports){'use strict';function reducer(item,memo,sep){var foo='',c=new RegExp(sep,'g'),q=new RegExp('"','g'),n=new RegExp('\n','g');if(!item){item='';}
if(typeof item!='string'){var s=item.toString();if(s=='[object Object]'){item=JSON.stringify(item);if(item=='{}'){item='';}}
else{item=s;}}
if(memo){foo=memo+sep;}
if(item.search(c)>=0||item.search(q)>=0||item.search(n)>=0){foo+='"'+item.replace(q,'""')+'"';}
else{foo+=''+item;}
return foo;}
exports.eol="\r\n";exports.separator=",";exports.detect=function(input)
{var separators=[{c:0,v:','},{c:0,v:';'},{c:0,v:'|'},{c:0,v:'\t'},{c:0,v:null}];separators.forEach(function(item,indice){item.c+=input.split(item.v).length;});var max=0;var separator=separators.reduce(function(prev,cur){if(cur.c>=max){max=cur.c;return cur.v;}
else{return prev;}},null);return separator;}
exports.stringify=function(input,sep){var ret='';sep=sep||exports.separator;if(Array.isArray(input)&&!Array.isArray(input[0])){input.forEach(function(item){ret=reducer(item,ret,sep);});ret+=exports.eol;}
else if(Array.isArray(input)&&Array.isArray(input[0])){input.forEach(function(item,index){ret+=exports.stringify(item,sep);});}
else if(typeof input=='object'){for(var key in input){if(input.hasOwnProperty(key)){ret=reducer(input[key],ret,sep);}}
ret+=exports.eol;}
else{ret=reducer(input,ret,sep)+exports.eol;}
return ret;}
exports.parse=function(input,sep){var output=[];exports.forEach(input,sep,function(row,index){output.push(row);})
return output;}
exports.forEach=function(input,sep,callback){if(arguments.length<3){callback=sep;sep=',';}
var i=0,s=0,r;while(r=exports.read(input.slice(s),sep,function(fields){callback(fields,i++);})){s+=r;}}
exports.read=function(input,sep,callback){sep=sep||",";var fields=[],reminderIndex=0,token='',endingIndex=0,endingLine=0,startingIndex=0,sepx=new RegExp('[^\\s'+sep+']+.');while(startingIndex<=input.length){endingIndex=input.indexOf(sep,startingIndex);endingLine=input.indexOf('\n',startingIndex);if(endingIndex<0){endingIndex=input.length;}
token=input.slice(startingIndex,endingIndex).trim();if(token.charAt(0)=='"'&&token.charAt(token.length-1)=='"'){fields.push(token.slice(1,-1).replace(/\"\"/g,'"'));startingIndex=endingIndex+1;}
else if(token.charAt(0)=='"'){var s=input.slice(startingIndex+1);if(s.indexOf('"')<0){reminderIndex=startingIndex;callback(fields);return reminderIndex;}
else{var i=s.search(/[^\"]\"(?!\")/)+1;if(i===0){i=s.search(/[^\"]\"\"\"(?!\")/)+3;}
fields.push(input.slice(startingIndex+1,startingIndex+i+1).replace(/\"\"/g,'"'));var j=input.slice(startingIndex+i+2).search(sepx);startingIndex+=i+2+(j>=0?j:0);}}
else if(endingLine>=0&&endingLine<endingIndex){if(input.charAt(endingLine-1)==='\r'){fields.push(input.slice(startingIndex,endingLine-1));}
else{fields.push(input.slice(startingIndex,endingLine));}
reminderIndex=endingLine+1;callback(fields);return reminderIndex;}
else if(token.charAt(token.length-1)=='"'){fields.push(input.slice(startingIndex,endingIndex));startingIndex=endingIndex+1;}
else{fields.push(input.slice(startingIndex,endingIndex));startingIndex=endingIndex+1;}}
reminderIndex=null;callback(fields);return reminderIndex;}
exports.fetch=function(input,sep){var output;exports.read(input,sep,function(fields){output=fields;});return output;}})(PlugAuth.CSV);if(!Array.prototype.indexOf){Array.prototype.indexOf=function(searchElement){"use strict";if(this==null){throw new TypeError();}
var t=Object(this);var len=t.length>>>0;if(len===0){return-1;}
var n=0;if(arguments.length>1){n=Number(arguments[1]);if(n!=n){n=0;}else if(n!=0&&n!=Infinity&&n!=-Infinity){n=(n>0||-1)*Math.floor(Math.abs(n));}}
if(n>=len){return-1;}
var k=n>=0?n:Math.max(len-Math.abs(n),0);for(;k<len;k++){if(k in t&&t[k]===searchElement){return k;}}
return-1;}}
/* =========================================================
 * bootstrap-datepicker.js 
 * http://www.eyecon.ro/bootstrap-datepicker
 * =========================================================
 * Copyright 2012 Stefan Petre
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================= */
!function($){var Datepicker=function(element,options){this.element=$(element);this.format=DPGlobal.parseFormat(options.format||this.element.data('date-format')||'mm/dd/yyyy');this.picker=$(DPGlobal.template)
.appendTo('body')
.on({click:$.proxy(this.click,this)});this.isInput=this.element.is('input');this.component=this.element.is('.date')?this.element.find('.add-on'):false;if(this.isInput){this.element.on({focus:$.proxy(this.show,this),keyup:$.proxy(this.update,this)});}else{if(this.component){this.component.on('click',$.proxy(this.show,this));}else{this.element.on('click',$.proxy(this.show,this));}}
this.minViewMode=options.minViewMode||this.element.data('date-minviewmode')||0;if(typeof this.minViewMode==='string'){switch(this.minViewMode){case'months':this.minViewMode=1;break;case'years':this.minViewMode=2;break;default:this.minViewMode=0;break;}}
this.viewMode=options.viewMode||this.element.data('date-viewmode')||0;if(typeof this.viewMode==='string'){switch(this.viewMode){case'months':this.viewMode=1;break;case'years':this.viewMode=2;break;default:this.viewMode=0;break;}}
this.startViewMode=this.viewMode;this.weekStart=options.weekStart||this.element.data('date-weekstart')||0;this.weekEnd=this.weekStart===0?6:this.weekStart-1;this.onRender=options.onRender;this.fillDow();this.fillMonths();this.update();this.showMode();};Datepicker.prototype={constructor:Datepicker,show:function(e){this.picker.show();this.height=this.component?this.component.outerHeight():this.element.outerHeight();this.place();$(window).on('resize',$.proxy(this.place,this));if(e){e.stopPropagation();e.preventDefault();}
if(!this.isInput){}
var that=this;$(document).on('mousedown',function(ev){if($(ev.target).closest('.datepicker').length==0){that.hide();}});this.element.trigger({type:'show',date:this.date});},hide:function(){this.picker.hide();$(window).off('resize',this.place);this.viewMode=this.startViewMode;this.showMode();if(!this.isInput){$(document).off('mousedown',this.hide);}
this.element.trigger({type:'hide',date:this.date});},set:function(){var formated=DPGlobal.formatDate(this.date,this.format);if(!this.isInput){if(this.component){this.element.find('input').prop('value',formated);}
this.element.data('date',formated);}else{this.element.prop('value',formated);}},setValue:function(newDate){if(typeof newDate==='string'){this.date=DPGlobal.parseDate(newDate,this.format);}else{this.date=new Date(newDate);}
this.set();this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),1,0,0,0,0);this.fill();},place:function(){var offset=this.component?this.component.offset():this.element.offset();this.picker.css({top:offset.top+this.height,left:offset.left});},update:function(newDate){this.date=DPGlobal.parseDate(typeof newDate==='string'?newDate:(this.isInput?this.element.prop('value'):this.element.data('date')),this.format);this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),1,0,0,0,0);this.fill();},fillDow:function(){var dowCnt=this.weekStart;var html='<tr>';while(dowCnt<this.weekStart+7){html+='<th class="dow">'+DPGlobal.dates.daysMin[(dowCnt++)%7]+'</th>';}
html+='</tr>';this.picker.find('.datepicker-days thead').append(html);},fillMonths:function(){var html='';var i=0
while(i<12){html+='<span class="month">'+DPGlobal.dates.monthsShort[i++]+'</span>';}
this.picker.find('.datepicker-months td').append(html);},fill:function(){var d=new Date(this.viewDate),year=d.getFullYear(),month=d.getMonth(),currentDate=this.date.valueOf();this.picker.find('.datepicker-days th:eq(1)')
.text(DPGlobal.dates.months[month]+' '+year);var prevMonth=new Date(year,month-1,28,0,0,0,0),day=DPGlobal.getDaysInMonth(prevMonth.getFullYear(),prevMonth.getMonth());prevMonth.setDate(day);prevMonth.setDate(day-(prevMonth.getDay()-this.weekStart+7)%7);var nextMonth=new Date(prevMonth);nextMonth.setDate(nextMonth.getDate()+42);nextMonth=nextMonth.valueOf();var html=[];var clsName,prevY,prevM;while(prevMonth.valueOf()<nextMonth){if(prevMonth.getDay()===this.weekStart){html.push('<tr>');}
clsName=this.onRender(prevMonth);prevY=prevMonth.getFullYear();prevM=prevMonth.getMonth();if((prevM<month&&prevY===year)||prevY<year){clsName+=' old';}else if((prevM>month&&prevY===year)||prevY>year){clsName+=' new';}
if(prevMonth.valueOf()===currentDate){clsName+=' active';}
html.push('<td class="day '+clsName+'">'+prevMonth.getDate()+'</td>');if(prevMonth.getDay()===this.weekEnd){html.push('</tr>');}
prevMonth.setDate(prevMonth.getDate()+1);}
this.picker.find('.datepicker-days tbody').empty().append(html.join(''));var currentYear=this.date.getFullYear();var months=this.picker.find('.datepicker-months')
.find('th:eq(1)')
.text(year)
.end()
.find('span').removeClass('active');if(currentYear===year){months.eq(this.date.getMonth()).addClass('active');}
html='';year=parseInt(year/10,10)*10;var yearCont=this.picker.find('.datepicker-years')
.find('th:eq(1)')
.text(year+'-'+(year+9))
.end()
.find('td');year-=1;for(var i=-1;i<11;i++){html+='<span class="year'+(i===-1||i===10?' old':'')+(currentYear===year?' active':'')+'">'+year+'</span>';year+=1;}
yearCont.html(html);},click:function(e){e.stopPropagation();e.preventDefault();var target=$(e.target).closest('span, td, th');if(target.length===1){switch(target[0].nodeName.toLowerCase()){case'th':switch(target[0].className){case'switch':this.showMode(1);break;case'prev':case'next':this.viewDate['set'+DPGlobal.modes[this.viewMode].navFnc].call(this.viewDate,this.viewDate['get'+DPGlobal.modes[this.viewMode].navFnc].call(this.viewDate)+
DPGlobal.modes[this.viewMode].navStep*(target[0].className==='prev'?-1:1));this.fill();this.set();break;}
break;case'span':if(target.is('.month')){var month=target.parent().find('span').index(target);this.viewDate.setMonth(month);}else{var year=parseInt(target.text(),10)||0;this.viewDate.setFullYear(year);}
if(this.viewMode!==0){this.date=new Date(this.viewDate);this.element.trigger({type:'changeDate',date:this.date,viewMode:DPGlobal.modes[this.viewMode].clsName});}
this.showMode(-1);this.fill();this.set();break;case'td':if(target.is('.day')&&!target.is('.disabled')){var day=parseInt(target.text(),10)||1;var month=this.viewDate.getMonth();if(target.is('.old')){month-=1;}else if(target.is('.new')){month+=1;}
var year=this.viewDate.getFullYear();this.date=new Date(year,month,day,0,0,0,0);this.viewDate=new Date(year,month,Math.min(28,day),0,0,0,0);this.fill();this.set();this.element.trigger({type:'changeDate',date:this.date,viewMode:DPGlobal.modes[this.viewMode].clsName});}
break;}}},mousedown:function(e){e.stopPropagation();e.preventDefault();},showMode:function(dir){if(dir){this.viewMode=Math.max(this.minViewMode,Math.min(2,this.viewMode+dir));}
this.picker.find('>div').hide().filter('.datepicker-'+DPGlobal.modes[this.viewMode].clsName).show();}};$.fn.datepicker=function(option,val){return this.each(function(){var $this=$(this),data=$this.data('datepicker'),options=typeof option==='object'&&option;if(!data){$this.data('datepicker',(data=new Datepicker(this,$.extend({},$.fn.datepicker.defaults,options))));}
if(typeof option==='string')data[option](val);});};$.fn.datepicker.defaults={onRender:function(date){return'';}};$.fn.datepicker.Constructor=Datepicker;var DPGlobal={modes:[{clsName:'days',navFnc:'Month',navStep:1},{clsName:'months',navFnc:'FullYear',navStep:1},{clsName:'years',navFnc:'FullYear',navStep:10}],dates:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},isLeapYear:function(year){return(((year%4===0)&&(year%100!==0))||(year%400===0))},getDaysInMonth:function(year,month){return[31,(DPGlobal.isLeapYear(year)?29:28),31,30,31,30,31,31,30,31,30,31][month]},parseFormat:function(format){var separator=format.match(/[.\/\-\s].*?/),parts=format.split(/\W+/);if(!separator||!parts||parts.length===0){throw new Error("Invalid date format.");}
return{separator:separator,parts:parts};},parseDate:function(date,format){var parts=date.split(format.separator),date=new Date(),val;date.setHours(0);date.setMinutes(0);date.setSeconds(0);date.setMilliseconds(0);if(parts.length===format.parts.length){var year=date.getFullYear(),day=date.getDate(),month=date.getMonth();for(var i=0,cnt=format.parts.length;i<cnt;i++){val=parseInt(parts[i],10)||1;switch(format.parts[i]){case'dd':case'd':day=val;date.setDate(val);break;case'mm':case'm':month=val-1;date.setMonth(val-1);break;case'yy':year=2000+val;date.setFullYear(2000+val);break;case'yyyy':year=val;date.setFullYear(val);break;}}
date=new Date(year,month,day,0,0,0);}
return date;},formatDate:function(date,format){var val={d:date.getDate(),m:date.getMonth()+1,yy:date.getFullYear().toString().substring(2),yyyy:date.getFullYear()};val.dd=(val.d<10?'0':'')+val.d;val.mm=(val.m<10?'0':'')+val.m;var date=[];for(var i=0,cnt=format.parts.length;i<cnt;i++){date.push(val[format.parts[i]]);}
return date.join(format.separator);},headTemplate:'<thead>'+
'<tr>'+
'<th class="prev">&lsaquo;</th>'+
'<th colspan="5" class="switch"></th>'+
'<th class="next">&rsaquo;</th>'+
'</tr>'+
'</thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>'};DPGlobal.template='<div class="datepicker dropdown-menu">'+
'<div class="datepicker-days">'+
'<table class=" table-condensed">'+
DPGlobal.headTemplate+
'<tbody></tbody>'+
'</table>'+
'</div>'+
'<div class="datepicker-months">'+
'<table class="table-condensed">'+
DPGlobal.headTemplate+
DPGlobal.contTemplate+
'</table>'+
'</div>'+
'<div class="datepicker-years">'+
'<table class="table-condensed">'+
DPGlobal.headTemplate+
DPGlobal.contTemplate+
'</table>'+
'</div>'+
'</div>';}(window.jQuery);if(PlugAuth===undefined)var PlugAuth={};if(PlugAuth.UI===undefined)PlugAuth.UI={};PlugAuth.UI.NAME='PlugAuth WebUI';PlugAuth.UI.VERSION='0.06';$(document).ready(function()
{var create_user_modal=new PlugAuth.UI.Modal('New User');create_user_modal.html('<form id="plugauth_webui_create_user_form">'
+'<input id="plugauth_webui_create_user_name"    name="user"    type="text"     placeholder="username" /><br/>'
+'<input id="plugauth_webui_create_user_pass"    name="pass"    type="password" placeholder="password" /><br/>'
+'<input id="plugauth_webui_create_user_confirm" name="confirm" type="password" placeholder="confirm"  />'
+'</form>'
+'<p id="plugauth_webui_create_user_message"></p>');create_user_modal.form=$('#plugauth_webui_create_user_form');create_user_modal.user=$('#plugauth_webui_create_user_name');create_user_modal.pass=$('#plugauth_webui_create_user_pass');create_user_modal.confirm=$('#plugauth_webui_create_user_confirm');create_user_modal.message=$('#plugauth_webui_create_user_message');remove_user_modal=new PlugAuth.UI.Modal('Remove User');remove_user_modal.html('<p>Please confirm removal of user <span id="plugauth_webui_remove_user_name"></span></p>');remove_user_modal.confirm=remove_user_modal.add_button('Remove','btn-danger');remove_user_modal.confirmed=function(){};remove_user_modal.confirm.click(function(){remove_user_modal.confirmed()});var counter=0;var page=new PlugAuth.UI.Page('users','accounts','user');page.select=function()
{$('#plugauth_webui_container').html('<p>wait</p>');var client=this.client;client.user_list()
.error(function(){$('#plugauth_webui_container').html('');PlugAuth.UI.error_modal.html('<p>Unable to retrieve user list</p>');PlugAuth.UI.error_modal.show();PlugAuth.UI.Menu.deselect();})
.success(function(data){var tl=new PlugAuth.UI.TabList(data,{new_label:'New User'});tl.download=function(){$('#plugauth_webui_csv_download').attr('href',PlugAuth.DL.data_to_uri({type:'text/csv',content:PlugAuth.CSV.stringify([['user']].concat(tl.get_display_list()))}));$('#plugauth_webui_csv_download').attr('download','plugauth_users.csv');return true;};tl.callback=function(user,pane){var index=counter++;pane.html('<h3>'+user+'</h3>'
+'<form id="plugauth_webui_change_password_'+index+'_form">'
+'<input class="span3" type="password" placeholder="password" id="plugauth_webui_change_password_'+index+'_password" /><br/>'
+'<input class="span3" type="password" placeholder="confirm"  id="plugauth_webui_change_password_'+index+'_confirm"/><br/>'
+'<button class="span3 btn btn-primary" type="button" id="plugauth_webui_change_password_'+index+'_submit" style="margin-left:0">Change Password</button><br/>'
+'<br/>'
+'<button class="span3 btn btn-danger" id="plugauth_webui_remove_user_button_'+index+'" style="margin-left:0" >Remove User</button>'
+'</form>');var change_password_widgets=$.map(['password','confirm','submit'],function(value,mapindex){var widget=$('#plugauth_webui_change_password_'+index+'_'+value);widget.attr('disabled','disabled');return widget;});if(user==client.user)
{$('#plugauth_webui_remove_user_button_'+index).attr('disabled','disabled');}
else
{$('#plugauth_webui_remove_user_button_'+index).click(function(){page.remove_user(user);return false;});client.can('change_password','user/'+user)
.success(function(){$.each(change_password_widgets,function(index,widget){widget.removeAttr('disabled')});$('#plugauth_webui_change_password_'+index+'_submit').click(function(){var password=$('#plugauth_webui_change_password_'+index+'_password').val();var confirm=$('#plugauth_webui_change_password_'+index+'_confirm').val();$('#plugauth_webui_change_password_'+index+'_password').val('');$('#plugauth_webui_change_password_'+index+'_confirm').val('');if(password!=confirm)
{PlugAuth.UI.error_modal.html('<p>Passwords do not match</p>');PlugAuth.UI.error_modal.show();return;}
if(password=='')
{PlugAuth.UI.error_modal.html('<p>Passwords is empty</p>');PlugAuth.UI.error_modal.show();return;}
client.change_password(user,password)
.success(function(){PlugAuth.UI.notice_modal.html('<p>Password changed</p>');PlugAuth.UI.notice_modal.show();})
.error(function(){PlugAuth.UI.error_modal.html('<p>Unable to change password</p>');PlugAuth.UI.error_modal.show();});});});}};tl.create=function(){create_user_modal.show();};page.create_user=function(){if(create_user_modal.pass.val()!=create_user_modal.confirm.val())
{create_user_modal.hide();PlugAuth.UI.error_modal.html('<p>Passwords do not match</p>');PlugAuth.UI.error_modal.show();return;}
create_user_modal.form.hide();create_user_modal.message.html('Please wait');create_user_modal.message.show();page.client.create_user(create_user_modal.user.val(),create_user_modal.pass.val())
.error(function(){create_user_modal.hide();PlugAuth.UI.error_modal.html('<p>Unable to create user</p>');PlugAuth.UI.error_modal.show();})
.success(function(){create_user_modal.hide();tl.prepend(create_user_modal.user.val());tl.select(create_user_modal.user.val());});};page.remove_user=function(user){remove_user_modal.confirmed=function()
{page.client.delete_user(user)
.success(function(){remove_user_modal.hide();tl.remove(user);})
.error(function(){remove_user_modal.hide();PlugAuth.UI.error_modal.html('<p>Unable to remove user</p>');PlugAuth.UI.error_modal.show();});}
remove_user_modal.show();};});}
page.order=10;create_user_modal.create_button=create_user_modal.add_button('Create','btn-primary');create_user_modal.create_button.click(function(){page.create_user()});create_user_modal.on('show',function(){create_user_modal.user.val('');create_user_modal.pass.val('');create_user_modal.confirm.val('');create_user_modal.form.show();create_user_modal.message.hide();create_user_modal.create_button.removeAttr('disabled');});create_user_modal.on('shown',function(){create_user_modal.user.focus();});PlugAuth.UI.bind_enter(create_user_modal.user,function(){create_user_modal.pass.focus()});PlugAuth.UI.bind_enter(create_user_modal.pass,function(){create_user_modal.confirm.focus()});PlugAuth.UI.bind_enter(create_user_modal.confirm,function(){page.create_user()});});"use strict";/*
 * Original code (c) 2010 Nick Galbreath
 * http://code.google.com/p/stringencoders/source/browse/#svn/trunk/javascript
 *
 * jQuery port (c) 2010 Carlo Zottmann
 * http://github.com/carlo/jquery-base64
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use,
 * copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following
 * conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 * OTHER DEALINGS IN THE SOFTWARE.
*/
jQuery.base64=(function($){var _PADCHAR="=",_ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_VERSION="1.0";function _getbyte64(s,i){var idx=_ALPHA.indexOf(s.charAt(i));if(idx===-1){throw"Cannot decode base64";}
return idx;}
function _decode(s){var pads=0,i,b10,imax=s.length,x=[];s=String(s);if(imax===0){return s;}
if(imax%4!==0){throw"Cannot decode base64";}
if(s.charAt(imax-1)===_PADCHAR){pads=1;if(s.charAt(imax-2)===_PADCHAR){pads=2;}
imax-=4;}
for(i=0;i<imax;i+=4){b10=(_getbyte64(s,i)<<18)|(_getbyte64(s,i+1)<<12)|(_getbyte64(s,i+2)<<6)|_getbyte64(s,i+3);x.push(String.fromCharCode(b10>>16,(b10>>8)&0xff,b10&0xff));}
switch(pads){case 1:b10=(_getbyte64(s,i)<<18)|(_getbyte64(s,i+1)<<12)|(_getbyte64(s,i+2)<<6);x.push(String.fromCharCode(b10>>16,(b10>>8)&0xff));break;case 2:b10=(_getbyte64(s,i)<<18)|(_getbyte64(s,i+1)<<12);x.push(String.fromCharCode(b10>>16));break;}
return x.join("");}
function _getbyte(s,i){var x=s.charCodeAt(i);if(x>255){throw"INVALID_CHARACTER_ERR: DOM Exception 5";}
return x;}
function _encode(s){if(arguments.length!==1){throw"SyntaxError: exactly one argument required";}
s=String(s);var i,b10,x=[],imax=s.length-s.length%3;if(s.length===0){return s;}
for(i=0;i<imax;i+=3){b10=(_getbyte(s,i)<<16)|(_getbyte(s,i+1)<<8)|_getbyte(s,i+2);x.push(_ALPHA.charAt(b10>>18));x.push(_ALPHA.charAt((b10>>12)&0x3F));x.push(_ALPHA.charAt((b10>>6)&0x3f));x.push(_ALPHA.charAt(b10&0x3f));}
switch(s.length-imax){case 1:b10=_getbyte(s,i)<<16;x.push(_ALPHA.charAt(b10>>18)+_ALPHA.charAt((b10>>12)&0x3F)+_PADCHAR+_PADCHAR);break;case 2:b10=(_getbyte(s,i)<<16)|(_getbyte(s,i+1)<<8);x.push(_ALPHA.charAt(b10>>18)+_ALPHA.charAt((b10>>12)&0x3F)+_ALPHA.charAt((b10>>6)&0x3f)+_PADCHAR);break;}
return x.join("");}
return{decode:_decode,encode:_encode,VERSION:_VERSION};}(jQuery));$(document).ready(function()
{var revoke_handler=function()
{var row=this.parentNode.parentNode;var resource=row.cells[0].innerHTML;var action=row.cells[1].innerHTML;var group=row.cells[2].innerHTML;page.client.revoke(group,action,resource)
.error(function(){PlugAuth.UI.error_modal.html('<p>Unable to revoke permission</p>');PlugAuth.UI.error_modal.show();})
.success(function(){row.parentNode.parentNode.deleteRow(row.rowIndex);});return false;}
var attach_revoke=function(){$('#plugauth_webui_granted_table tbody tr td button').unbind('click',revoke_handler);$('#plugauth_webui_granted_table tbody tr td button').click(revoke_handler);};var grant_modal=(function(){var modal=new PlugAuth.UI.Modal('Grant');modal.html('<form>'
+'<input type="text" class="span3" placeholder="resource"   id="plugauth_webui_grant_resource" data-provide="typeahead" /><br />'
+'<input type="text" class="span3" placeholder="action"     id="plugauth_webui_grant_action"   data-provide="typeahead" /><br />'
+'<input type="text" class="span3" placeholder="user/group" id="plugauth_webui_grant_group"    data-provide="typeahead" /><br />'
+'<br /><br />'
+'</form>');var resource=$('#plugauth_webui_grant_resource');var action=$('#plugauth_webui_grant_action');var group=$('#plugauth_webui_grant_group');modal.on('show',function(){resource.val('');action.val('');page.client.actions()
.success(function(data){action.typeahead({source:data.sort()});});group.val('');page.client.granted()
.success(function(data){resource.typeahead({source:$.map(data,function(line){return line.replace(/\s*\(.*$/,'')}).sort()});});var group_list=[];var count=0;page.client.user_list()
.success(function(data){group_list=group_list.concat(data);if(++count==2)
group.typeahead({source:group_list.sort()});});page.client.group_list()
.success(function(data){group_list=group_list.concat(data);if(++count==2)
group.typeahead({source:group_list.sort()});});});modal.on('shown',function(){resource.focus();});var counter
var grant=function()
{modal.hide();page.client.grant(group.val(),action.val(),resource.val())
.success(function(){$('#plugauth_webui_granted_table tbody').prepend('<tr><td>'+resource.val().replace(/^\/?/,'/')
+'</td><td>'+action.val()
+'</td><td>'+group.val()
+'</td><td><button class="btn btn-danger">Revoke</button></td></tr>');attach_revoke();})
.error(function(){PlugAuth.UI.error_modal.html('<p>Unable to grant permission</p>');PlugAuth.UI.error_modal.show();});return false;}
PlugAuth.UI.bind_enter(resource,function(){action.focus()});PlugAuth.UI.bind_enter(action,function(){group.focus()});PlugAuth.UI.bind_enter(group,function(){grant()});modal.add_button('Grant','btn-primary').click(function(){grant()});return modal;})();var page=new PlugAuth.UI.Page('resources','accounts','grant');page.select=function()
{$('#plugauth_webui_toolbar').html('<form class="navbar-form pull-left">'
+'<input type="text" placeholder="Search" id="plugauth_webui_resource_search">'
+'</form><form class="navbar-form pull-left">'
+'<button class="btn" id="plugauth_webui_resource_grant_button">Grant</button>'
+'<a href="#" class="btn small" id="plugauth_webui_resource_download" download="plugauth_resources.csv">CSV</a>'
+'</form>');$('#plugauth_webui_resource_download').click(function()
{var csv_data=[];$('#plugauth_webui_granted_table tr').each(function(index,tr){if($(tr).css('display')!='none')
csv_data.push([$(tr).children().eq(0).html(),$(tr).children().eq(1).html(),$(tr).children().eq(2).html()]);});$('#plugauth_webui_resource_download').attr('href',PlugAuth.DL.data_to_uri({type:'text/csv',content:PlugAuth.CSV.stringify(csv_data)}));return true;});(function(){var input=$('#plugauth_webui_resource_search');var search=function(){var search_text=input.val();$('#plugauth_webui_granted_table tbody tr').each(function(index,row){if(search_text==''||row.cells[0].innerHTML.indexOf(search_text)!=-1||row.cells[1].innerHTML.indexOf(search_text)!=-1||row.cells[2].innerHTML.indexOf(search_text)!=-1)
{row.style.display='table-row';}
else
{row.style.display='none';}});};input.change(search);PlugAuth.UI.bind_enter(input,search);})();$('#plugauth_webui_resource_grant_button').click(function(){grant_modal.show();return false;});$('#plugauth_webui_container').html('<table id="plugauth_webui_granted_table" class="table table-striped"><thead></thead><tbody></tbody></table>');$('#plugauth_webui_granted_table thead').html('<tr><th>resource</th><th>action</th><th>user/group</th><th>control</th></tr>');page.client.granted()
.error(function(){PlugAuth.UI.error_modal.html('<p>Unable to retrieve grant list</p>');PlugAuth.UI.error_modal.show();})
.success(function(data){$.each(data,function(index,value){var match=value.match(/^(.*) \((.*)\): (.*)$/);if(match)
{var group_list=match[3].split(',');var disabled='';$.each(group_list,function(index,group){group=group.replace(/^\s+/,'').replace(/\s+$/,'');if((group==page.client.user&&(match[2]=='change_password'||match[2]=='accounts'))||(group=='#u'&&match[1].match(/#u/)))
disabled=' disabled="disabled"';$('#plugauth_webui_granted_table tbody').append('<tr>'
+'<td>'+match[1]+'</td>'
+'<td>'+match[2]+'</td>'
+'<td>'+group+'</td>'
+'<td><button class="btn btn-danger"'+disabled+'>Revoke</button></td>'
+'</tr>');});}});attach_revoke();});}
page.order=30;});if(PlugAuth===undefined)var PlugAuth={};if(PlugAuth.UI===undefined)PlugAuth.UI={};(function()
{var max_label_length=25;var label=function(name)
{var label=name;if(label.length>max_label_length)
{label=label.substr(0,max_label_length-3);label+='...';}
return label;}
PlugAuth.UI.TabList=function(list,opts)
{var nav_html='';var pane_html='';if(opts===undefined)
opts={};if(opts.new_label===undefined)
opts.new_label='new';list=list.sort();this.list=list;this.display_list=list;$.each(list,function(index,value){nav_html+='<li id="plugauth_webui_tab_nav_'+index+'">'
+'<a id="plugauth_webui_tab_nav_a_'+index+'" href="#plugauth_webui_tab_content_'+index+'" data-toggle="tab">'
+label(value)+'</a></li>';pane_html+='<div class="tab-pane" id="plugauth_webui_tab_content_'+index+'"></div>';});$('#plugauth_webui_toolbar').html('<form class="navbar-form pull-left">'
+'<input type="text" placeholder="Search" id="plugauth_webui_tab_search">'
+'</form><form class="navbar-form pull-left">'
+'<button class="btn" id="plugauth_webui_tab_create">'+opts.new_label+'</button>'
+'<a href="#" class="btn small" id="plugauth_webui_csv_download">CSV</a>'
+'</form>');$('#plugauth_webui_container').html('<div class="tabbable tabs-left">'
+'<ul class="nav nav-tabs" id="plugauth_webui_tab_nav">'
+nav_html+'</ul>'
+'<div class="tab-content" id="plugauth_webui_tab_content">'
+pane_html+'</div></div>');this.callback=function(){};this.create=function(){};var tl=this;$.each(list,function(index,value){var content=$('#plugauth_webui_tab_content_'+index);$('#plugauth_webui_tab_nav_a_'+index).click(function(){if(content.html()=='')
tl.callback(value,content);return true;});});$('#plugauth_webui_tab_form').submit(function(){return false});$('#plugauth_webui_tab_create').click(function(){tl.create();return false});$('#plugauth_webui_csv_download').click(function(){return tl.download()});var input=$('#plugauth_webui_tab_search');var search=function(){tl.search(input.val());return false};input.change(search);PlugAuth.UI.bind_enter(input,search);}
PlugAuth.UI.TabList.prototype.search=function(text)
{var display_list=this.display_list=[];$.each(this.list,function(index,value){if(value.indexOf(text)==-1)
{$('#plugauth_webui_tab_nav_'+index).hide();$('#plugauth_webui_tab_nav_'+index).removeClass('active');$('#plugauth_webui_tab_content_'+index).removeClass('active');}
else
{$('#plugauth_webui_tab_nav_'+index).show();display_list.push(value);}});}
PlugAuth.UI.TabList.prototype.get_display_list=function()
{return this.display_list;}
PlugAuth.UI.TabList.prototype.append=function(value)
{var index=this.list.length;$('#plugauth_webui_tab_nav').append('<li id="plugauth_webui_tab_nav_'+index+'">'
+'<a id="plugauth_webui_tab_nav_a_'+index+'" href="#plugauth_webui_tab_content_'+index+'" data-toggle="tab">'
+label(value)+'</a></li>');$('#plugauth_webui_tab_content').append('<div class="tab-pane" id="plugauth_webui_tab_content_'+index+'"></div>');this.list.push(value);this.display_list.push(value);var tl=this;var content=$('#plugauth_webui_tab_content_'+index);$('#plugauth_webui_tab_nav_a_'+index).click(function(){tl.callback(value,content);return true});}
PlugAuth.UI.TabList.prototype.prepend=function(value)
{var index=this.list.length;$('#plugauth_webui_tab_nav').prepend('<li id="plugauth_webui_tab_nav_'+index+'">'
+'<a id="plugauth_webui_tab_nav_a_'+index+'" href="#plugauth_webui_tab_content_'+index+'" data-toggle="tab">'
+label(value)+'</a></li>');$('#plugauth_webui_tab_content').prepend('<div class="tab-pane" id="plugauth_webui_tab_content_'+index+'"></div>');this.list.push(value);this.display_list.unshift(value);var tl=this;var content=$('#plugauth_webui_tab_content_'+index);$('#plugauth_webui_tab_nav_a_'+index).click(function(){tl.callback(value,content);return true});}
PlugAuth.UI.TabList.prototype.remove=function(search_value)
{var display_list=this.display_list=[];$.each(this.list,function(index,value){if(value==search_value)
{$('#plugauth_webui_tab_nav_'+index).remove();$('#plugauth_webui_tab_content_'+index).remove();}
else if($('#plugauth_webui_tab_nav_'+index).css('display')!='none')
{display_list.push(value);}});}
PlugAuth.UI.TabList.prototype.select=function(search_value)
{var tl=this;$.each(this.list,function(index,value){var nav=$('#plugauth_webui_tab_nav_'+index);var content=$('#plugauth_webui_tab_content_'+index);if(value==search_value)
{nav.addClass('active');content.addClass('active');if(content.html()=='')
tl.callback(value,content);}
else
{nav.removeClass('active');content.removeClass('active');}});}})();if(PlugAuth===undefined)var PlugAuth={};if(PlugAuth.UI===undefined)PlugAuth.UI={};PlugAuth.UI.bind_enter=function(input,callback){input.keypress(function(event){if(event.which==10||event.which==13)
{callback();return false;}
else
{return true;}});}
PlugAuth.UI.setup=function(client)
{$('#plugauth_webui_container').html('<div id="plugauth_webui_welcome"><p>Welcome to PlugAuth</p></div>');$('#plugauth_webui_welcome').append('<p>Client is <strong>'+PlugAuth.UI.NAME+'</strong> version <strong>'+PlugAuth.UI.VERSION+'</strong></p>');var pages=PlugAuth.UI.pages.sort(function(a,b){return a.order-b.order});$.each(pages,function(index,page){page.enable(client);});client.status()
.success(function(data){if(data.server_version===null)
data.server_version='dev';$('#plugauth_webui_welcome').append('<p>Server is <strong>'+data.app_name+'</strong> '
+'version <strong>'+data.server_version+'</strong> '
+'on <strong>'+data.server_hostname+'</strong></p>');});client.audit_check()
.success(function(data){$('#plugauth_webui_welcome').append('<p>Audit Plugin version <strong>'+data.version+'</string></p>');});}
$(document).ready(function(){PlugAuth.UI.error_modal=new PlugAuth.UI.Modal('Error');PlugAuth.UI.notice_modal=new PlugAuth.UI.Modal('Notice');PlugAuth.UI.data=JSON.parse($('#plugauth_webui_data').val());});PlugAuth.UI.main=function(){if(PlugAuth.UI.data.skip_login==1)
{var client=new PlugAuth.Client(PlugAuth.UI.data.api_url,PlugAuth.UI.data.user);PlugAuth.UI.setup(client);}
else if(PlugAuth.UI.data.requires_authentic_credentials==1)
{PlugAuth.UI.login.enable();}
else
{var client=new PlugAuth.Client(PlugAuth.UI.data.api_url);client.can=PlugAuth.Client.create_fake_method('ok',200);PlugAuth.UI.setup(client);}};$(document).ready(function()
{var create_group_modal=new PlugAuth.UI.Modal('New Group');create_group_modal.html('<form id="plugauth_webui_create_group_form">'
+'<input name="group" type="text" placeholder="group name" />'
+'<br/>'
+'<select multiple="multiple" size="15" class="span3" id=""></select>'
+'</form>'
+'<p id="plugauth_webui_create_group_message"></p>');create_group_modal.create_button=create_group_modal.add_button('Create','btn-primary');create_group_modal.create_button.click(function(){page.create_group()});create_group_modal.groupname=$('#plugauth_webui_create_group_form input');create_group_modal.select=$('#plugauth_webui_create_group_form select');create_group_modal.form=$('#plugauth_webui_create_group_form');create_group_modal.message=$('#plugauth_webui_create_group_message');create_group_modal.on('shown',function(){create_group_modal.groupname.focus();});var remove_group_modal=new PlugAuth.UI.Modal('Remove User');remove_group_modal.html('<p>Please confirm removal of user <span id="plugauth_webui_remove_user_name"></span></p>');remove_group_modal.confirm=remove_group_modal.add_button('Remove','btn-danger');remove_group_modal.confirmed=function(){};remove_group_modal.confirm.click(function(){remove_group_modal.confirmed()});var download_modal=new PlugAuth.UI.Modal('Download');download_modal.html('<a href="#" class="btn small" id="plugauth_webui_group_csv_download" download="plugauth_groups.csv">Wait</a>');var page=new PlugAuth.UI.Page('groups','accounts','group');var get_user_lists=function(group,cb)
{var count=0;var user_in;var user_out;var fixup=function(){user_out=$.grep(user_out,function(value){return user_in.indexOf(value)==-1;});};var error=function(){$('#plugauth_webui_container').html('');PlugAuth.UI.error_modal.html('<p>Unable to retrieve user lists</p>');PlugAuth.UI.error_modal.show();PlugAuth.UI.Menu.deselect();};page.client.user_list()
.success(function(data){count++;user_out=data.sort();if(count==2)
{fixup();cb(user_in,user_out);}})
.error(error);page.client.users(group)
.success(function(data){count++;user_in=data.sort();if(count==2)
{fixup();cb(user_in,user_out);}})
.error(error);}
var counter=0;page.select=function()
{$('#plugauth_webui_container').html('<p>wait</p>');this.client.group_list()
.error(function(){$('#plugauth_webui_container').html('');PlugAuth.UI.error_modal.html('<p>Unable to retrieve group list</p>');PlugAuth.UI.error_modal.show();PlugAuth.UI.Menu.deselect();})
.success(function(data){var tl=new PlugAuth.UI.TabList(data,{new_label:'New Group'});tl.download=function(){var a=$('#plugauth_webui_group_csv_download');a.html('Wait');a.addClass('disabled');var waiter=function(){return false;};a.click(waiter);download_modal.show();var count=0;var user_map={};var finish=function(){a.html('CSV');a.removeClass('disabled');a.unbind('click',waiter);var csv_data=[['group','user']];tl.get_display_list().forEach(function(group){if(user_map[group].length==0)
{csv_data=csv_data.concat([[group,'~']]);}
else
{user_map[group].forEach(function(user){csv_data=csv_data.concat([[group,user]]);});}});a.attr('href',PlugAuth.DL.data_to_uri({type:'text/csv',content:PlugAuth.CSV.stringify(csv_data)}));};tl.get_display_list().forEach(function(group){count++;page.client.users(group)
.success(function(users){count--;user_map[group]=users;if(count==0)
finish();})
.error(function(){count--;user_map[group]=['ERROR'];if(count==0)
finish();});});return false;};tl.callback=function(group,pane){get_user_lists(group,function(user_in,user_out){var id='plugauth_webui_group_membership_'+counter++;pane.html('<h3>'+group+'<h3>'
+'<form>'
+'<select multiple="multiple" size="15" class="span3" id="'+id+'_in_list">'
+$.map(user_in,function(value){return'<option>'+value+'</option>'}).join('')
+'</select>'
+'<select multiple="multiple" size="15" class="span3" id="'+id+'_out_list">'
+$.map(user_out,function(value){return'<option>'+value+'</option>'}).join('')
+'</select>'
+'<br/>'
+'<button class="btn btn-danger span3" style="margin-left:0" id="'+id+'_remove_button">Remove Selected</button>'
+'<button class="btn btn-success span3" style="margin-left:0" id="'+id+'_add_button">Add Selected</button>'
+'<br/>'
+'<button class="btn span3" style="margin-left:0" id="'+id+'_select_all_remove_button">Select All</button>'
+'<button class="btn span3" style="margin-left:0" id="'+id+'_select_all_add_button">Select All</button>'
+'<br/>'
+'<button class="btn btn-danger span3" style="margin-left:0; margin-top:20px;" id="'+id+'_remove_group_button">Remove Group</button>'
+'</form>');var _in={list:$('#'+id+'_in_list'),exe:$('#'+id+'_remove_button'),all:$('#'+id+'_select_all_remove_button'),};var _out={list:$('#'+id+'_out_list'),exe:$('#'+id+'_add_button'),all:$('#'+id+'_select_all_add_button'),};_in.all.click(function(){$('#'+id+'_in_list option').attr("selected","selected");return false});_out.all.click(function(){$('#'+id+'_out_list option').attr("selected","selected");return false});$('#'+id+'_remove_group_button').click(function(){page.remove_group(group);return false;});var remove_single_user=function()
{var user=this.text;var option=this;page.client.group_delete_user(group,user)
.error(function(){PlugAuth.UI.error_modal.html('<p>Unable to remove user from group</p>');PlugAuth.UI.error_modal.show();})
.success(function(){option.parentNode.remove(option.index);var option_id=id+'_option_'+counter++;_out.list.prepend('<option id="'+option_id+'">'+user+'</option>');$('#'+option_id).dblclick(add_single_user);});return false;}
var add_single_user=function()
{var user=this.text;var option=this;page.client.group_add_user(group,user)
.error(function(){PlugAuth.UI.error_modal.html('<p>Unable to add user to group</p>');PlugAuth.UI.error_modal.show();})
.success(function(){option.parentNode.remove(option.index);var option_id=id+'_option_'+counter++;_in.list.prepend('<option id="'+option_id+'">'+user+'</option>');$('#'+option_id).dblclick(remove_single_user);});return false;}
$('#'+id+'_in_list option').dblclick(remove_single_user);$('#'+id+'_out_list option').dblclick(add_single_user);var refresh=function()
{get_user_lists(group,function(new_user_in,new_user_out){user_in=new_user_in;user_out=new_user_out;_in.list.html($.map(user_in,function(value){return'<option>'+value+'</option>'}).join(''));_out.list.html($.map(user_out,function(value){return'<option>'+value+'</option>'}).join(''));$('#'+id+'_in_list option').dblclick(remove_single_user);$('#'+id+'_out_list option').dblclick(add_single_user);});};var update_group=function(new_list){page.client.update_group(group,new_list)
.error(function(){PlugAuth.UI.error_modal.html('<p>Unable to update group</p>');PlugAuth.UI.error_modal.show();})
.success(refresh);};_in.exe.click(function(){var cull_list=$('#'+id+'_in_list option:selected').map(function(){return this.text}).get();if(cull_list.length==0)
{PlugAuth.UI.error_modal.html('<p>No users selected</p>');PlugAuth.UI.error_modal.show();}
var new_list=$.grep(user_in,function(value){return cull_list.indexOf(value)==-1});update_group(new_list);return false;});_out.exe.click(function(){var add_list=$('#'+id+'_out_list option:selected').map(function(){return this.text}).get();if(add_list.length==0)
{PlugAuth.UI.error_modal.html('<p>No users selected</p>');PlugAuth.UI.error_modal.show();}
var new_list=user_in.concat(add_list);update_group(new_list);return false;});});};tl.create=function(){page.client.user_list()
.error(function(){PlugAuth.UI.error_modal.html('<p>Unable to retreieve user list</p>');PlugAuth.UI.error_modal.show();})
.success(function(data){create_group_modal.form.show();create_group_modal.message.hide();create_group_modal.groupname.val('');create_group_modal.select.html($.map(data,function(value){return'<option>'+value+'</option>'}));create_group_modal.show();});};page.create_group=function()
{create_group_modal.form.hide();create_group_modal.message.html('<p>please wait</p>');create_group_modal.message.show();var group=create_group_modal.groupname.val();var users=$('#plugauth_webui_create_group_form select option:selected').map(function(){return this.text}).get();page.client.create_group(group,users)
.error(function(){create_group_modal.hide();PlugAuth.UI.error_modal.html('<p>Unable to create group</p>');PlugAuth.UI.error_modal.show();})
.success(function(){create_group_modal.hide();tl.prepend(group);tl.select(group);});}
page.remove_group=function(group){remove_group_modal.confirmed=function()
{page.client.delete_group(group)
.error(function(){remove_group_modal.hide();PlugAuth.UI.error_modal.html('<p>Unable to create group</p>');PlugAuth.UI.error_modal.show();})
.success(function(){remove_group_modal.hide();tl.remove(group);});};remove_group_modal.show();}});}
page.order=20;});if(PlugAuth===undefined)var PlugAuth={};if(PlugAuth.UI===undefined)PlugAuth.UI={};(function()
{var counter=0;PlugAuth.UI.Modal=function(title)
{this.title=title;this.index=counter++;this.ready=false;$('body').append('<div class="modal hide fade" id="plugauth_webui_modal_'+this.index+'">'
+'  <div class="modal-header">'
+'    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>'
+'    <h3>'+title+'</h3>'
+'  </div>'
+'  <div class="modal-body" id="plugauth_webui_modal_'+this.index+'_body">'
+'  </div>'
+'  <div class="modal-footer" id="plugauth_webui_modal_'+this.index+'_footer">'
+'    <a href="#" class="btn" id="plugauth_webui_modal_'+this.index+'_close">Close</a>'
+'  </div>'
+'</div>');var modal=this;$('#plugauth_webui_modal_'+this.index+'_close').click(function(){modal.hide();});}
PlugAuth.UI.Modal.prototype.html=function(html)
{$('#plugauth_webui_modal_'+this.index+'_body').html(html);}
PlugAuth.UI.Modal.prototype.show=function()
{$('#plugauth_webui_modal_'+this.index).modal('show');}
PlugAuth.UI.Modal.prototype.hide=function()
{$('#plugauth_webui_modal_'+this.index).modal('hide');}
var counter2=0;PlugAuth.UI.Modal.prototype.add_button=function(label,button_class)
{var index=counter2++;var html='<button id="plugauth_webui_modal_button_'+index+'" class="btn '+button_class;html+='" type="button">'+label+'</button>';$('#plugauth_webui_modal_'+this.index+'_footer').prepend(html);return $('#plugauth_webui_modal_button_'+index);}
PlugAuth.UI.Modal.prototype.on=function(event_name,callback)
{$('#plugauth_webui_modal_'+this.index).on(event_name,callback);}})();if(PlugAuth===undefined)var PlugAuth={};if(PlugAuth.UI===undefined)PlugAuth.UI={};(function()
{PlugAuth.UI.pages=[];PlugAuth.UI.Page=function(name,action,resource)
{this.action=action;this.resource=resource;this.name=name;this.order=999999;PlugAuth.UI.pages.push(this);}
PlugAuth.UI.Page.prototype.enable=function(client)
{this.client=client;var page=this;var menu=new PlugAuth.UI.Menu.MenuItem(this.name);this.can().success(function()
{menu.show();menu.click(function(){$('#plugauth_webui_toolbar').html('');page.select();});});}
PlugAuth.UI.Page.prototype.can=function()
{return this.client.can(this.action,this.resource);}})();if(PlugAuth===undefined)var PlugAuth={};if(PlugAuth.DL===undefined)PlugAuth.DL={};(function()
{PlugAuth.DL.data_to_uri=function(data)
{return'data:'+data.type+';charset='+(data.charset||'UTF-8')+','+encodeURIComponent(data.content);}})();