if(PlugAuth===undefined)var PlugAuth={};if(PlugAuth.UI===undefined)PlugAuth.UI={};(function()
{var page=PlugAuth.UI.login={};page.enable=function()
{$('#plugauth_webui_container').html('<form>'
+'<input id="plugauth_webui_login_user" name="user" type="text"     placeholder="username" />'
+'<br/>'
+'<input id="plugauth_webui_login_pass" name="pass" type="password" placeholder="password" />'
+'</form>');$('#plugauth_webui_toolbar').html('');PlugAuth.UI.Menu.clear();var user=$('#plugauth_webui_login_user');var pass=$('#plugauth_webui_login_pass');user.focus();$(document).ready(function(){PlugAuth.UI.bind_enter(user,function(){pass.focus()});PlugAuth.UI.bind_enter(pass,function(){page.attempt(user.val(),pass.val())});});}
page.attempt=function(user,pass)
{var client=new PlugAuth.Client(PlugAuth.UI.data.api_url);client.login(user,pass);client.auth()
.success(function(){page.success(client)})
.error(page.error);}
page.success=function(client)
{PlugAuth.UI.setup(client);var menu=new PlugAuth.UI.Menu.MenuItem('logout');menu.click(page.enable);menu.show();}
$(document).ready(function(){var login_error_modal=new PlugAuth.UI.Modal('Authentication Error');login_error_modal.html('<p>Either the credentials you provided were wrong, or there was an error in transport with the PlugAuth server.</p>'
+'<p>Response: <span class="badge badge-important" id="plugauth_webui_login_error_status"></span>'
+'             <span id="plugauth_webui_login_error_data"></span></p>');page.error=function(data,status)
{$('#plugauth_webui_login_error_status').html(status);$('#plugauth_webui_login_error_data').html(data);login_error_modal.show();};});})();if(PlugAuth===undefined)var PlugAuth={};if(PlugAuth.UI===undefined)PlugAuth.UI={};if(PlugAuth.UI.Menu===undefined)PlugAuth.UI.Menu={};(function()
{var counter=0;PlugAuth.UI.Menu.MenuItem=function(aName)
{this.name=aName;this.index=counter++;$('#plugauth_webui_main_menu').append('<li class="plugauth_webui_menu_item" id="plugauth_webui_menu_'+this.index+'_li">'
+'<a href="#" id="plugauth_webui_menu_'+this.index+'_a">'+this.name+'</a></li>');this.li=$('#plugauth_webui_menu_'+this.index+'_li');this.a=$('#plugauth_webui_menu_'+this.index+'_a');var mi=this;this.li.hide();this.a.click(function(){PlugAuth.UI.Menu.deselect();mi.select();mi.cb();return false;});this.cb=function(){};}
PlugAuth.UI.Menu.MenuItem.prototype.hide=function(){this.li.hide()}
PlugAuth.UI.Menu.MenuItem.prototype.show=function(){this.li.show()}
PlugAuth.UI.Menu.MenuItem.prototype.click=function(cb){this.cb=cb}
PlugAuth.UI.Menu.MenuItem.prototype.select=function(){this.li.addClass('active')}
PlugAuth.UI.Menu.clear=function()
{$('#plugauth_webui_main_menu').html('');}
PlugAuth.UI.Menu.deselect=function()
{$('.plugauth_webui_menu_item').removeClass('active');}})();if(PlugAuth===undefined)var PlugAuth={};(function()
{PlugAuth.Client=function(aUrl)
{this.url=aUrl.replace(/\/$/,'');}
PlugAuth.Client.prototype.login=function(aUsername,aPassword)
{this.user=aUsername;this.pass=aPassword;return this;}
PlugAuth.Client.prototype.logout=function()
{delete this.user;delete this.pass;return this;}
PlugAuth.Client.create_fake_method=function(fake_data,fake_status)
{return function(){var tx=new PlugAuth.Client.Tx();setTimeout(function(){tx.success_cb(fake_data,fake_status)},1);return tx;};}
var request=function(client,args)
{args=jQuery.extend({},args);if(!(client.user===undefined))
{var hash=$.base64.encode(client.user+':'+client.pass);args.beforeSend=function(req){req.setRequestHeader('Authorization','Basic '+hash);}}
args.url=client.url+args.url+'.json';var tx=new PlugAuth.Client.Tx();$.ajax(args)
.success(function(aData,textStatus,jqXHR)
{var data;if(jqXHR.getResponseHeader('Content-Type')=='application/json')
{data=JSON.parse(jqXHR.responseText);}
else
{data=aData;}
tx.success_cb(data,jqXHR.status);})
.error(function(jqXHR,textStatus,errorThrown)
{tx.error_cb(jqXHR.responseText,jqXHR.status)});return tx;}
PlugAuth.Client.prototype.version=function()
{return request(this,{url:'/version',type:'GET',});}
PlugAuth.Client.prototype.status=function()
{return request(this,{url:'/status',type:'GET',});}
PlugAuth.Client.prototype.auth=function()
{return request(this,{url:'/auth',type:'GET',});}
PlugAuth.Client.prototype.api=function()
{return request(this,{url:'/api',type:'GET',});}
PlugAuth.Client.prototype.welcome=function()
{return request(this,{url:'/',type:'GET',});}
PlugAuth.Client.prototype.authz=function(aUser,aAction,aResource)
{return request(this,{url:'/authz/user/'+[aUser,aAction,aResource].join('/'),type:'GET',});}
PlugAuth.Client.prototype.can=function(aAction,aResource)
{return this.authz(this.user,aAction,aResource);}
PlugAuth.Client.prototype.user_list=function()
{return request(this,{url:'/user',type:'GET'})}
PlugAuth.Client.prototype.group_list=function()
{return request(this,{url:'/group',type:'GET'})}
PlugAuth.Client.prototype.create_user=function(aUsername,aPassword)
{return request(this,{url:'/user',type:'POST',data:{user:aUsername,password:aPassword},});}
PlugAuth.Client.prototype.change_password=function(aUsername,aPassword)
{return request(this,{url:'/user/'+aUsername,type:'POST',data:{password:aPassword},});}
PlugAuth.Client.prototype.delete_user=function(aUsername)
{return request(this,{url:'/user/'+aUsername,type:'DELETE',});}
PlugAuth.Client.prototype.groups=function(aUsername)
{return request(this,{url:'/groups/'+aUsername,type:'GET',});}
PlugAuth.Client.prototype.users=function(aGroupname)
{return request(this,{url:'/users/'+aGroupname,type:'GET',});}
PlugAuth.Client.prototype.update_group=function(aGroupname,aUserlist)
{return request(this,{url:'/group/'+aGroupname,type:'POST',data:{users:aUserlist.join(',')},});}
PlugAuth.Client.prototype.group_add_user=function(aGroupname,aUser)
{return request(this,{url:'/group/'+aGroupname+'/'+aUser,type:'POST',});}
PlugAuth.Client.prototype.group_delete_user=function(aGroupname,aUser)
{return request(this,{url:'/group/'+aGroupname+'/'+aUser,type:'DELETE',});}
PlugAuth.Client.prototype.create_group=function(aGroupname,aUserlist)
{return request(this,{url:'/group',type:'POST',data:{group:aGroupname,users:aUserlist.join(',')},});}
PlugAuth.Client.prototype.delete_group=function(aGroupname)
{return request(this,{url:'/group/'+aGroupname,type:'DELETE',});}
PlugAuth.Client.prototype.granted=function()
{return request(this,{url:'/grant',type:'GET',});}
PlugAuth.Client.prototype.revoke=function(aUsername,aAction,aResource)
{return request(this,{url:'/grant/'+aUsername+'/'+aAction+'/'+aResource,type:'DELETE',});}
PlugAuth.Client.prototype.actions=function()
{return request(this,{url:'/actions',type:'GET',});}
PlugAuth.Client.prototype.grant=function(aUsername,aAction,aResource)
{return request(this,{url:'/grant/'+aUsername+'/'+aAction+'/'+aResource,type:'POST',});}
PlugAuth.Client.prototype.test_basic=function()
{return request(this,{url:'/test/setup/basic',type:'POST',});}
PlugAuth.Client.Tx=function()
{this.success_cb=function(){};this.error_cb=function(){};}
PlugAuth.Client.Tx.prototype.success=function(aFunction){this.success_cb=aFunction;return this}
PlugAuth.Client.Tx.prototype.error=function(aFunction){this.error_cb=aFunction;return this}})();$(document).ready(function()
{var page=new PlugAuth.UI.Page('password');page.select=function()
{$('#plugauth_webui_container').html('<h3>'+page.client.user+'<h3>'
+'<form id="plugauth_webui_change_password_form">'
+'<input class="span3" type="password" placeholder="password" id="plugauth_webui_change_password_password" /><br/>'
+'<input class="span3" type="password" placeholder="confirm"  id="plugauth_webui_change_password_confirm"/><br/>'
+'<button class="span3 btn btn-primary" type="button" id="plugauth_webui_change_password_submit" style="margin-left:0">Change Password</button>'
+'</form>');var password=$('#plugauth_webui_change_password_password');var confirm=$('#plugauth_webui_change_password_confirm');var submit=$('#plugauth_webui_change_password_submit');var change_password=function()
{if(password.val()=='')
{PlugAuth.UI.error_modal.html('<p>Passwords is empty</p>');PlugAuth.UI.error_modal.show();}
else if(password.val()!=confirm.val())
{PlugAuth.UI.error_modal.html('<p>Passwords do not match</p>');PlugAuth.UI.error_modal.show();}
else
{var new_password=password.val();var client=page.client;client.change_password(client.user,new_password)
.success(function(){PlugAuth.UI.notice_modal.html('<p>Password changed</p>');PlugAuth.UI.notice_modal.show();client.login(client.user,new_password);})
.error(function(){PlugAuth.UI.error_modal.html('<p>Error changing password</p>');PlugAuth.UI.error_modal.show();});}
password.val('');confirm.val('');};submit.click(change_password);PlugAuth.UI.bind_enter(password,function(){confirm.focus()});PlugAuth.UI.bind_enter(confirm,change_password);}
page.order=40;page.can=function()
{return page.client.can('change_password','user/'+page.client.user)}});if(!Array.prototype.indexOf){Array.prototype.indexOf=function(searchElement){"use strict";if(this==null){throw new TypeError();}
var t=Object(this);var len=t.length>>>0;if(len===0){return-1;}
var n=0;if(arguments.length>1){n=Number(arguments[1]);if(n!=n){n=0;}else if(n!=0&&n!=Infinity&&n!=-Infinity){n=(n>0||-1)*Math.floor(Math.abs(n));}}
if(n>=len){return-1;}
var k=n>=0?n:Math.max(len-Math.abs(n),0);for(;k<len;k++){if(k in t&&t[k]===searchElement){return k;}}
return-1;}}
if(PlugAuth===undefined)var PlugAuth={};if(PlugAuth.UI===undefined)PlugAuth.UI={};PlugAuth.UI.NAME='PlugAuth WebUI';PlugAuth.UI.VERSION='0.03';$(document).ready(function()
{var create_user_modal=new PlugAuth.UI.Modal('New User');create_user_modal.html('<form id="plugauth_webui_create_user_form">'
+'<input id="plugauth_webui_create_user_name"    name="user"    type="text"     placeholder="username" /><br/>'
+'<input id="plugauth_webui_create_user_pass"    name="pass"    type="password" placeholder="password" /><br/>'
+'<input id="plugauth_webui_create_user_confirm" name="confirm" type="password" placeholder="confirm"  />'
+'</form>'
+'<p id="plugauth_webui_create_user_message"></p>');create_user_modal.form=$('#plugauth_webui_create_user_form');create_user_modal.user=$('#plugauth_webui_create_user_name');create_user_modal.pass=$('#plugauth_webui_create_user_pass');create_user_modal.confirm=$('#plugauth_webui_create_user_confirm');create_user_modal.message=$('#plugauth_webui_create_user_message');remove_user_modal=new PlugAuth.UI.Modal('Remove User');remove_user_modal.html('<p>Please confirm removal of user <span id="plugauth_webui_remove_user_name"></span></p>');remove_user_modal.confirm=remove_user_modal.add_button('Remove','btn-danger');remove_user_modal.confirmed=function(){};remove_user_modal.confirm.click(function(){remove_user_modal.confirmed()});var counter=0;var page=new PlugAuth.UI.Page('users','accounts','user');page.select=function()
{$('#plugauth_webui_container').html('<p>wait</p>');var client=this.client;client.user_list()
.error(function(){$('#plugauth_webui_container').html('');PlugAuth.UI.error_modal.html('<p>Unable to retrieve user list</p>');PlugAuth.UI.error_modal.show();PlugAuth.UI.Menu.deselect();})
.success(function(data){var tl=new PlugAuth.UI.TabList(data,{new_label:'New User'});tl.callback=function(user,pane){var index=counter++;pane.html('<h3>'+user+'</h3>'
+'<form id="plugauth_webui_change_password_'+index+'_form">'
+'<input class="span3" type="password" placeholder="password" id="plugauth_webui_change_password_'+index+'_password" /><br/>'
+'<input class="span3" type="password" placeholder="confirm"  id="plugauth_webui_change_password_'+index+'_confirm"/><br/>'
+'<button class="span3 btn btn-primary" type="button" id="plugauth_webui_change_password_'+index+'_submit" style="margin-left:0">Change Password</button><br/>'
+'<br/>'
+'<button class="span3 btn btn-danger" id="plugauth_webui_remove_user_button_'+index+'" style="margin-left:0" >Remove User</button>'
+'</form>');var change_password_widgets=$.map(['password','confirm','submit'],function(value,mapindex){var widget=$('#plugauth_webui_change_password_'+index+'_'+value);widget.attr('disabled','disabled');return widget;});if(user==client.user)
{$('#plugauth_webui_remove_user_button_'+index).attr('disabled','disabled');}
else
{$('#plugauth_webui_remove_user_button_'+index).click(function(){page.remove_user(user);});client.can('change_password','user/'+user)
.success(function(){$.each(change_password_widgets,function(index,widget){widget.removeAttr('disabled')});$('#plugauth_webui_change_password_'+index+'_submit').click(function(){var password=$('#plugauth_webui_change_password_'+index+'_password').val();var confirm=$('#plugauth_webui_change_password_'+index+'_confirm').val();$('#plugauth_webui_change_password_'+index+'_password').val('');$('#plugauth_webui_change_password_'+index+'_confirm').val('');if(password!=confirm)
{PlugAuth.UI.error_modal.html('<p>Passwords do not match</p>');PlugAuth.UI.error_modal.show();return;}
if(password=='')
{PlugAuth.UI.error_modal.html('<p>Passwords is empty</p>');PlugAuth.UI.error_modal.show();return;}
client.change_password(user,password)
.success(function(){PlugAuth.UI.notice_modal.html('<p>Password changed</p>');PlugAuth.UI.notice_modal.show();})
.error(function(){PlugAuth.UI.error_modal.html('<p>Unable to change password</p>');PlugAuth.UI.error_modal.show();});});});}};tl.create=function(){create_user_modal.show();};page.create_user=function(){if(create_user_modal.pass.val()!=create_user_modal.confirm.val())
{create_user_modal.hide();PlugAuth.UI.error_modal.html('<p>Passwords do not match</p>');PlugAuth.UI.error_modal.show();return;}
create_user_modal.form.hide();create_user_modal.message.html('Please wait');create_user_modal.message.show();page.client.create_user(create_user_modal.user.val(),create_user_modal.pass.val())
.error(function(){create_user_modal.hide();PlugAuth.UI.error_modal.html('<p>Unable to create user</p>');PlugAuth.UI.error_modal.show();})
.success(function(){create_user_modal.hide();tl.prepend(create_user_modal.user.val());tl.select(create_user_modal.user.val());});};page.remove_user=function(user){remove_user_modal.confirmed=function()
{page.client.delete_user(user)
.success(function(){remove_user_modal.hide();tl.remove(user);})
.error(function(){remove_user_modal.hide();PlugAuth.UI.error_modal.html('<p>Unable to remove user</p>');PlugAuth.UI.error_modal.show();});}
remove_user_modal.show();};});}
page.order=10;create_user_modal.create_button=create_user_modal.add_button('Create','btn-primary');create_user_modal.create_button.click(function(){page.create_user()});create_user_modal.on('show',function(){create_user_modal.user.val('');create_user_modal.pass.val('');create_user_modal.confirm.val('');create_user_modal.form.show();create_user_modal.message.hide();create_user_modal.create_button.removeAttr('disabled');});create_user_modal.on('shown',function(){create_user_modal.user.focus();});PlugAuth.UI.bind_enter(create_user_modal.user,function(){create_user_modal.pass.focus()});PlugAuth.UI.bind_enter(create_user_modal.pass,function(){create_user_modal.confirm.focus()});PlugAuth.UI.bind_enter(create_user_modal.confirm,function(){page.create_user()});});$(document).ready(function()
{var revoke_handler=function()
{var row=this.parentNode.parentNode;var resource=row.cells[0].innerHTML;var action=row.cells[1].innerHTML;var group=row.cells[2].innerHTML;page.client.revoke(group,action,resource)
.error(function(){PlugAuth.UI.error_modal.html('<p>Unable to revoke permission</p>');PlugAuth.UI.error_modal.show();})
.success(function(){row.parentNode.parentNode.deleteRow(row.rowIndex);});return false;}
var attach_revoke=function(){$('#plugauth_webui_granted_table tbody tr td button').unbind('click',revoke_handler);$('#plugauth_webui_granted_table tbody tr td button').click(revoke_handler);};var grant_modal=(function(){var modal=new PlugAuth.UI.Modal('Grant');modal.html('<form>'
+'<input type="text" class="span3" placeholder="resource"   id="plugauth_webui_grant_resource" /><br />'
+'<input type="text" class="span3" placeholder="action"     id="plugauth_webui_grant_action"   data-provide="typeahead" /><br />'
+'<input type="text" class="span3" placeholder="user/group" id="plugauth_webui_grant_group"    /><br />'
+'</form>');var resource=$('#plugauth_webui_grant_resource');var action=$('#plugauth_webui_grant_action');var group=$('#plugauth_webui_grant_group');modal.on('show',function(){resource.val('');action.val('');page.client.actions()
.success(function(data){action.typeahead({source:data.sort()});});group.val('');});modal.on('shown',function(){resource.focus();});var counter
var grant=function()
{modal.hide();page.client.grant(group.val(),action.val(),resource.val())
.success(function(){$('#plugauth_webui_granted_table tbody').prepend('<tr><td>'+resource.val().replace(/^\/?/,'/')
+'</td><td>'+action.val()
+'</td><td>'+group.val()
+'</td><td><button class="btn btn-danger">Revoke</button></td></tr>');attach_revoke();})
.error(function(){PlugAuth.UI.error_modal.html('<p>Unable to grant permission</p>');PlugAuth.UI.error_modal.show();});return false;}
PlugAuth.UI.bind_enter(resource,function(){action.focus()});PlugAuth.UI.bind_enter(action,function(){group.focus()});PlugAuth.UI.bind_enter(group,function(){grant()});modal.add_button('Grant','btn-primary').click(function(){grant()});return modal;})();var page=new PlugAuth.UI.Page('resources','accounts','grant');page.select=function()
{$('#plugauth_webui_toolbar').html('<form class="navbar-form pull-left">'
+'<input type="text" class="span2" placeholder="Search" id="plugauth_webui_resource_search">'
+'</form><form class="navbar-form pull-left">'
+'<button class="btn" id="plugauth_webui_resource_grant_button">Grant</button>'
+'</form>');(function(){var input=$('#plugauth_webui_resource_search');var search=function(){var search_text=input.val();$('#plugauth_webui_granted_table tbody tr').each(function(index,row){if(search_text==''||row.cells[0].innerHTML.indexOf(search_text)!=-1||row.cells[1].innerHTML.indexOf(search_text)!=-1||row.cells[2].innerHTML.indexOf(search_text)!=-1)
{row.style.display='table-row';}
else
{row.style.display='none';}});};input.change(search);PlugAuth.UI.bind_enter(input,search);})();$('#plugauth_webui_resource_grant_button').click(function(){grant_modal.show();return false;});$('#plugauth_webui_container').html('<table id="plugauth_webui_granted_table" class="table table-striped"><thead></thead><tbody></tbody></table>');$('#plugauth_webui_granted_table thead').html('<tr><th>resource</th><th>action</th><th>user/group</th><th>control</th></tr>');page.client.granted()
.error(function(){PlugAuth.UI.error_modal.html('<p>Unable to retrieve grant list</p>');PlugAuth.UI.error_modal.show();})
.success(function(data){$.each(data,function(index,value){var match=value.match(/^(.*) \((.*)\): (.*)$/);if(match)
{var group_list=match[3].split(',');var disabled='';$.each(group_list,function(index,group){group=group.replace(/^\s+/,'').replace(/\s+$/,'');if((group==page.client.user&&(match[2]=='change_password'||match[2]=='accounts'))||(group=='#u'&&match[1].match(/#u/)))
disabled=' disabled="disabled"';$('#plugauth_webui_granted_table tbody').append('<tr>'
+'<td>'+match[1]+'</td>'
+'<td>'+match[2]+'</td>'
+'<td>'+group+'</td>'
+'<td><button class="btn btn-danger"'+disabled+'>Revoke</button></td>'
+'</tr>');});}});attach_revoke();});}
page.order=30;});if(PlugAuth===undefined)var PlugAuth={};if(PlugAuth.UI===undefined)PlugAuth.UI={};(function()
{var max_label_length=25;var label=function(name)
{var label=name;if(label.length>max_label_length)
{label=label.substr(0,max_label_length-3);label+='...';}
return label;}
PlugAuth.UI.TabList=function(list,opts)
{var nav_html='';var pane_html='';if(opts===undefined)
opts={};if(opts.new_label===undefined)
opts.new_label='new';list=list.sort();this.list=list;$.each(list,function(index,value){nav_html+='<li id="plugauth_webui_tab_nav_'+index+'">'
+'<a id="plugauth_webui_tab_nav_a_'+index+'" href="#plugauth_webui_tab_content_'+index+'" data-toggle="tab">'
+label(value)+'</a></li>';pane_html+='<div class="tab-pane" id="plugauth_webui_tab_content_'+index+'"></div>';});$('#plugauth_webui_toolbar').html('<form class="navbar-form pull-left">'
+'<input type="text" class="span2" placeholder="Search" id="plugauth_webui_tab_search">'
+'</form><form class="navbar-form pull-left">'
+'<button class="btn" id="plugauth_webui_tab_create">'+opts.new_label+'</button>'
+'</form>');$('#plugauth_webui_container').html('<div class="tabbable tabs-left">'
+'<ul class="nav nav-tabs" id="plugauth_webui_tab_nav">'
+nav_html+'</ul>'
+'<div class="tab-content" id="plugauth_webui_tab_content">'
+pane_html+'</div></div>');this.callback=function(){};this.create=function(){};var tl=this;$.each(list,function(index,value){var content=$('#plugauth_webui_tab_content_'+index);$('#plugauth_webui_tab_nav_a_'+index).click(function(){if(content.html()=='')
tl.callback(value,content);return true;});});$('#plugauth_webui_tab_form').submit(function(){return false});$('#plugauth_webui_tab_create').click(function(){tl.create();return false});var input=$('#plugauth_webui_tab_search');var search=function(){tl.search(input.val());return false};input.change(search);PlugAuth.UI.bind_enter(input,search);}
PlugAuth.UI.TabList.prototype.search=function(text)
{$.each(this.list,function(index,value){if(value.indexOf(text)==-1)
{$('#plugauth_webui_tab_nav_'+index).hide();$('#plugauth_webui_tab_nav_'+index).removeClass('active');$('#plugauth_webui_tab_content_'+index).removeClass('active');}
else
{$('#plugauth_webui_tab_nav_'+index).show();}});}
PlugAuth.UI.TabList.prototype.append=function(value)
{var index=this.list.length;$('#plugauth_webui_tab_nav').append('<li id="plugauth_webui_tab_nav_'+index+'">'
+'<a id="plugauth_webui_tab_nav_a_'+index+'" href="#plugauth_webui_tab_content_'+index+'" data-toggle="tab">'
+label(value)+'</a></li>');$('#plugauth_webui_tab_content').append('<div class="tab-pane" id="plugauth_webui_tab_content_'+index+'"></div>');this.list.push(value);var tl=this;var content=$('#plugauth_webui_tab_content_'+index);$('#plugauth_webui_tab_nav_a_'+index).click(function(){tl.callback(value,content);return true});}
PlugAuth.UI.TabList.prototype.prepend=function(value)
{var index=this.list.length;$('#plugauth_webui_tab_nav').prepend('<li id="plugauth_webui_tab_nav_'+index+'">'
+'<a id="plugauth_webui_tab_nav_a_'+index+'" href="#plugauth_webui_tab_content_'+index+'" data-toggle="tab">'
+label(value)+'</a></li>');$('#plugauth_webui_tab_content').prepend('<div class="tab-pane" id="plugauth_webui_tab_content_'+index+'"></div>');this.list.push(value);var tl=this;var content=$('#plugauth_webui_tab_content_'+index);$('#plugauth_webui_tab_nav_a_'+index).click(function(){tl.callback(value,content);return true});}
PlugAuth.UI.TabList.prototype.remove=function(search_value)
{$.each(this.list,function(index,value){if(value==search_value)
{$('#plugauth_webui_tab_nav_'+index).remove();$('#plugauth_webui_tab_content_'+index).remove();}});}
PlugAuth.UI.TabList.prototype.select=function(search_value)
{var tl=this;$.each(this.list,function(index,value){var nav=$('#plugauth_webui_tab_nav_'+index);var content=$('#plugauth_webui_tab_content_'+index);if(value==search_value)
{nav.addClass('active');content.addClass('active');if(content.html()=='')
tl.callback(value,content);}
else
{nav.removeClass('active');content.removeClass('active');}});}})();if(PlugAuth===undefined)var PlugAuth={};if(PlugAuth.UI===undefined)PlugAuth.UI={};PlugAuth.UI.bind_enter=function(input,callback){input.keypress(function(event){if(event.which==10||event.which==13)
{callback();return false;}
else
{return true;}});}
PlugAuth.UI.setup=function(client)
{$('#plugauth_webui_container').html('<div id="plugauth_webui_welcome"><p>Welcome to PlugAuth</p></div>');$('#plugauth_webui_welcome').append('<p>Client is <strong>'+PlugAuth.UI.NAME+'</strong> version <strong>'+PlugAuth.UI.VERSION+'</strong></p>');var pages=PlugAuth.UI.pages.sort(function(a,b){return a.order-b.order});$.each(pages,function(index,page){page.enable(client);});client.status()
.success(function(data){if(data.server_version===null)
data.server_version='dev';$('#plugauth_webui_welcome').append('<p>Server is <strong>'+data.app_name+'</strong> '
+'version <strong>'+data.server_version+'</strong> '
+'on <strong>'+data.server_hostname+'</strong></p>');});}
$(document).ready(function(){PlugAuth.UI.error_modal=new PlugAuth.UI.Modal('Error');PlugAuth.UI.notice_modal=new PlugAuth.UI.Modal('Notice');PlugAuth.UI.data=JSON.parse($('#plugauth_webui_data').val());});PlugAuth.UI.main=function(){if(PlugAuth.UI.data.requires_authentic_credentials==1)
{PlugAuth.UI.login.enable();}
else
{var client=new PlugAuth.Client(PlugAuth.UI.data.api_url);client.can=PlugAuth.Client.create_fake_method('ok',200);PlugAuth.UI.setup(client);}};$(document).ready(function()
{var create_group_modal=new PlugAuth.UI.Modal('New Group');create_group_modal.html('<form id="plugauth_webui_create_group_form">'
+'<input name="group" type="text" placeholder="group name" />'
+'<br/>'
+'<select multiple="multiple" size="15" class="span3" id=""></select>'
+'</form>'
+'<p id="plugauth_webui_create_group_message"></p>');create_group_modal.create_button=create_group_modal.add_button('Create','btn-primary');create_group_modal.create_button.click(function(){page.create_group()});create_group_modal.groupname=$('#plugauth_webui_create_group_form input');create_group_modal.select=$('#plugauth_webui_create_group_form select');create_group_modal.form=$('#plugauth_webui_create_group_form');create_group_modal.message=$('#plugauth_webui_create_group_message');create_group_modal.on('shown',function(){create_group_modal.groupname.focus();});remove_group_modal=new PlugAuth.UI.Modal('Remove User');remove_group_modal.html('<p>Please confirm removal of user <span id="plugauth_webui_remove_user_name"></span></p>');remove_group_modal.confirm=remove_group_modal.add_button('Remove','btn-danger');remove_group_modal.confirmed=function(){};remove_group_modal.confirm.click(function(){remove_group_modal.confirmed()});var page=new PlugAuth.UI.Page('groups','accounts','group');var get_user_lists=function(group,cb)
{var count=0;var user_in;var user_out;var fixup=function(){user_out=$.grep(user_out,function(value){return user_in.indexOf(value)==-1;});};var error=function(){$('#plugauth_webui_container').html('');PlugAuth.UI.error_modal.html('<p>Unable to retrieve user lists</p>');PlugAuth.UI.error_modal.show();PlugAuth.UI.Menu.deselect();};page.client.user_list()
.success(function(data){count++;user_out=data.sort();if(count==2)
{fixup();cb(user_in,user_out);}})
.error(error);page.client.users(group)
.success(function(data){count++;user_in=data.sort();if(count==2)
{fixup();cb(user_in,user_out);}})
.error(error);}
var counter=0;page.select=function()
{$('#plugauth_webui_container').html('<p>wait</p>');this.client.group_list()
.error(function(){$('#plugauth_webui_container').html('');PlugAuth.UI.error_modal.html('<p>Unable to retrieve group list</p>');PlugAuth.UI.error_modal.show();PlugAuth.UI.Menu.deselect();})
.success(function(data){var tl=new PlugAuth.UI.TabList(data,{new_label:'New Group'});tl.callback=function(group,pane){get_user_lists(group,function(user_in,user_out){var id='plugauth_webui_group_membership_'+counter++;pane.html('<h3>'+group+'<h3>'
+'<form>'
+'<select multiple="multiple" size="15" class="span3" id="'+id+'_in_list">'
+$.map(user_in,function(value){return'<option>'+value+'</option>'}).join('')
+'</select>'
+'<select multiple="multiple" size="15" class="span3" id="'+id+'_out_list">'
+$.map(user_out,function(value){return'<option>'+value+'</option>'}).join('')
+'</select>'
+'<br/>'
+'<button class="btn btn-danger span3" style="margin-left:0" id="'+id+'_remove_button">Remove Selected</button>'
+'<button class="btn btn-success span3" style="margin-left:0" id="'+id+'_add_button">Add Selected</button>'
+'<br/>'
+'<button class="btn span3" style="margin-left:0" id="'+id+'_select_all_remove_button">Select All</button>'
+'<button class="btn span3" style="margin-left:0" id="'+id+'_select_all_add_button">Select All</button>'
+'<br/>'
+'<button class="btn btn-danger span3" style="margin-left:0; margin-top:20px;" id="'+id+'_remove_group_button">Remove Group</button>'
+'</form>');var _in={list:$('#'+id+'_in_list'),exe:$('#'+id+'_remove_button'),all:$('#'+id+'_select_all_remove_button'),};var _out={list:$('#'+id+'_out_list'),exe:$('#'+id+'_add_button'),all:$('#'+id+'_select_all_add_button'),};_in.all.click(function(){$('#'+id+'_in_list option').attr("selected","selected");return false});_out.all.click(function(){$('#'+id+'_out_list option').attr("selected","selected");return false});$('#'+id+'_remove_group_button').click(function(){page.remove_group(group);});var remove_single_user=function()
{var user=this.text;var option=this;page.client.group_delete_user(group,user)
.error(function(){PlugAuth.UI.error_modal.html('<p>Unable to remove user from group</p>');PlugAuth.UI.error_modal.show();})
.success(function(){option.parentNode.remove(option.index);var option_id=id+'_option_'+counter++;_out.list.prepend('<option id="'+option_id+'">'+user+'</option>');$('#'+option_id).dblclick(add_single_user);});return false;}
var add_single_user=function()
{var user=this.text;var option=this;page.client.group_add_user(group,user)
.error(function(){PlugAuth.UI.error_modal.html('<p>Unable to add user to group</p>');PlugAuth.UI.error_modal.show();})
.success(function(){option.parentNode.remove(option.index);var option_id=id+'_option_'+counter++;_in.list.prepend('<option id="'+option_id+'">'+user+'</option>');$('#'+option_id).dblclick(remove_single_user);});return false;}
$('#'+id+'_in_list option').dblclick(remove_single_user);$('#'+id+'_out_list option').dblclick(add_single_user);var refresh=function()
{get_user_lists(group,function(new_user_in,new_user_out){user_in=new_user_in;user_out=new_user_out;_in.list.html($.map(user_in,function(value){return'<option>'+value+'</option>'}).join(''));_out.list.html($.map(user_out,function(value){return'<option>'+value+'</option>'}).join(''));$('#'+id+'_in_list option').dblclick(remove_single_user);$('#'+id+'_out_list option').dblclick(add_single_user);});};var update_group=function(new_list){page.client.update_group(group,new_list)
.error(function(){PlugAuth.UI.error_modal.html('<p>Unable to update group</p>');PlugAuth.UI.error_modal.show();})
.success(refresh);};_in.exe.click(function(){var cull_list=$('#'+id+'_in_list option:selected').map(function(){return this.text}).get();if(cull_list.length==0)
{PlugAuth.UI.error_modal.html('<p>No users selected</p>');PlugAuth.UI.error_modal.show();}
var new_list=$.grep(user_in,function(value){return cull_list.indexOf(value)==-1});update_group(new_list);return false;});_out.exe.click(function(){var add_list=$('#'+id+'_out_list option:selected').map(function(){return this.text}).get();if(add_list.length==0)
{PlugAuth.UI.error_modal.html('<p>No users selected</p>');PlugAuth.UI.error_modal.show();}
var new_list=user_in.concat(add_list);update_group(new_list);return false;});});};tl.create=function(){page.client.user_list()
.error(function(){PlugAuth.UI.error_modal.html('<p>Unable to retreieve user list</p>');PlugAuth.UI.error_modal.show();})
.success(function(data){create_group_modal.form.show();create_group_modal.message.hide();create_group_modal.groupname.val('');create_group_modal.select.html($.map(data,function(value){return'<option>'+value+'</option>'}));create_group_modal.show();});};page.create_group=function()
{create_group_modal.form.hide();create_group_modal.message.html('<p>please wait</p>');create_group_modal.message.show();var group=create_group_modal.groupname.val();var users=$('#plugauth_webui_create_group_form select option:selected').map(function(){return this.text}).get();page.client.create_group(group,users)
.error(function(){create_group_modal.hide();PlugAuth.UI.error_modal.html('<p>Unable to create group</p>');PlugAuth.UI.error_modal.show();})
.success(function(){create_group_modal.hide();tl.prepend(group);tl.select(group);});}
page.remove_group=function(group){remove_group_modal.confirmed=function()
{page.client.delete_group(group)
.error(function(){remove_group_modal.hide();PlugAuth.UI.error_modal.html('<p>Unable to create group</p>');PlugAuth.UI.error_modal.show();})
.success(function(){remove_group_modal.hide();tl.remove(group);});};remove_group_modal.show();}});}
page.order=20;});if(PlugAuth===undefined)var PlugAuth={};if(PlugAuth.UI===undefined)PlugAuth.UI={};(function()
{var counter=0;PlugAuth.UI.Modal=function(title)
{this.title=title;this.index=counter++;this.ready=false;$('body').append('<div class="modal hide fade" id="plugauth_webui_modal_'+this.index+'">'
+'  <div class="modal-header">'
+'    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>'
+'    <h3>'+title+'</h3>'
+'  </div>'
+'  <div class="modal-body" id="plugauth_webui_modal_'+this.index+'_body">'
+'  </div>'
+'  <div class="modal-footer" id="plugauth_webui_modal_'+this.index+'_footer">'
+'    <a href="#" class="btn" id="plugauth_webui_modal_'+this.index+'_close">Close</a>'
+'  </div>'
+'</div>');var modal=this;$('#plugauth_webui_modal_'+this.index+'_close').click(function(){modal.hide();});}
PlugAuth.UI.Modal.prototype.html=function(html)
{$('#plugauth_webui_modal_'+this.index+'_body').html(html);}
PlugAuth.UI.Modal.prototype.show=function()
{$('#plugauth_webui_modal_'+this.index).modal('show');}
PlugAuth.UI.Modal.prototype.hide=function()
{$('#plugauth_webui_modal_'+this.index).modal('hide');}
var counter2=0;PlugAuth.UI.Modal.prototype.add_button=function(label,button_class)
{var index=counter2++;var html='<button id="plugauth_webui_modal_button_'+index+'" class="btn '+button_class;html+='" type="button">'+label+'</button>';$('#plugauth_webui_modal_'+this.index+'_footer').prepend(html);return $('#plugauth_webui_modal_button_'+index);}
PlugAuth.UI.Modal.prototype.on=function(event_name,callback)
{$('#plugauth_webui_modal_'+this.index).on(event_name,callback);}})();if(PlugAuth===undefined)var PlugAuth={};if(PlugAuth.UI===undefined)PlugAuth.UI={};(function()
{PlugAuth.UI.pages=[];PlugAuth.UI.Page=function(name,action,resource)
{this.action=action;this.resource=resource;this.name=name;this.order=999999;PlugAuth.UI.pages.push(this);}
PlugAuth.UI.Page.prototype.enable=function(client)
{this.client=client;var page=this;var menu=new PlugAuth.UI.Menu.MenuItem(this.name);this.can().success(function()
{menu.show();menu.click(function(){$('#plugauth_webui_toolbar').html('');page.select();});});}
PlugAuth.UI.Page.prototype.can=function()
{return this.client.can(this.action,this.resource);}})();